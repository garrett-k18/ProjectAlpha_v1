# ============================================================================
# Railway Configuration for statebridge_CRON Service
# ============================================================================
# WHAT: Dedicated config for the StateBridge FTPS import cron job
# WHY: CRON services don't run web servers, so they need different settings
# HOW: Point this service to use this config file in Railway Dashboard:
#      Settings → Build → Config File Path → railway-cron.toml
# ============================================================================

[build]
builder = "RAILPACK"

[deploy]
# WHAT: Run the StateBridge FTPS import command
# WHY: This is a scheduled job, not a web server
# HOW: Django management command that downloads and imports data from StateBridge FTPS
startCommand = "bash -lc \"set -euo pipefail; echo \\\"[statebridge] starting kind=loan\\\"; /app/.venv/bin/python manage.py import_statebridge_from_ftps --kind loan --latest-only --quiet; echo \\\"[statebridge] finished kind=loan\\\"; echo \\\"[statebridge] starting kind=foreclosure\\\"; /app/.venv/bin/python manage.py import_statebridge_from_ftps --kind foreclosure --latest-only --quiet; echo \\\"[statebridge] finished kind=foreclosure\\\"; echo \\\"[statebridge] starting kind=bankruptcy\\\"; /app/.venv/bin/python manage.py import_statebridge_from_ftps --kind bankruptcy --latest-only --quiet; echo \\\"[statebridge] finished kind=bankruptcy\\\"; echo \\\"[statebridge] starting kind=comment\\\"; /app/.venv/bin/python manage.py import_statebridge_from_ftps --kind comment --latest-only --quiet; echo \\\"[statebridge] finished kind=comment\\\"; echo \\\"[statebridge] starting kind=pay_history\\\"; /app/.venv/bin/python manage.py import_statebridge_from_ftps --kind pay_history --latest-only --quiet; echo \\\"[statebridge] finished kind=pay_history\\\"; echo \\\"[statebridge] starting kind=transaction\\\"; /app/.venv/bin/python manage.py import_statebridge_from_ftps --kind transaction --latest-only --quiet; echo \\\"[statebridge] finished kind=transaction\\\"; echo \\\"[statebridge] starting kind=arm\\\"; /app/.venv/bin/python manage.py import_statebridge_from_ftps --kind arm --latest-only --quiet; echo \\\"[statebridge] finished kind=arm\\\"\""

# WHAT: No healthcheck for CRON services
# WHY: CRON jobs don't run a web server, so HTTP healthchecks would always fail
# NOTE: Leaving healthcheckPath undefined disables healthchecks

# WHAT: Restart policy for failed jobs
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

[deploy.envVars]
DJANGO_SETTINGS_MODULE = "projectalphav1.settings"
PYTHONUNBUFFERED = "1"
DJANGO_DEBUG = "0"
PYTHONWARNINGS = "ignore::FutureWarning"

